# GraphQL ì„ ì‚¬ìš©í•˜ëŠ” ë°±ì—”ë“œ ì„œë²„

2-1-graphql-api-setup

---

## a. í”„ë¡œì íŠ¸ ìƒì„±

* Node.js í”„ë¡œì íŠ¸ ìƒì„±

  * `npm init`

* index.js íŒŒì¼ ìƒì„±

* package.json - "scripts" í•­ëª© ì¶”ê°€

  * ì´ì œ `npm start` ëª…ë ¹ì–´ë¡œ nodemon ì´ìš© ê°€ëŠ¥

  ```json
  "start": "nodemon index.js"
  ```



## b. ëª©(mock) ë°ì´í„°ë² ì´ìŠ¤ ëª¨ë“ˆ ì‚½ì…

* 2-1-graphql-api-setup í´ë” ì•ˆ ë‚´ìš©ë“¤ì„ í”„ë¡œì íŠ¸ë¡œ ì´ë™

* index.js

  ```json
  const database = require('./database')
  console.log(database)	
  ```

* í•„ìš” ëª¨ë“ˆ ì„¤ì¹˜ ë’¤ í…ŒìŠ¤íŠ¸ (ì„ íƒì‚¬í•­)

  ```json
  npm i convert-csv-to-json
  npm start
  ```

* `console.log(database.people[0])` âœ database object ë¥¼ ì‚¬ìš©í•´ì„œ ë§ˆìŒëŒ€ë¡œ ë°ì´í„°ë¥¼ êº¼ë‚´ì“¸ ìˆ˜ ìˆë‹¤.

  * ì €ì¥ë§Œ í•˜ë©´ nodemon ë•ë¶„ì— ë°”ë¡œ ë°˜ì˜ì´ ë˜ëŠ” ê±¸ ë³¼ ìˆ˜ ìˆë‹¤.
  * ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë©ˆì¶”ë ¤ë©´ Ctrl + C



## c. Apollo ì„œë²„ ì„¤ì¹˜

* ë°±ì—”ë“œ ì„œë²„ë‹ˆê¹Œ Apollo ì„œë²„ ëª¨ë“ˆì´ í•„ìš”í•˜ë‹¤.

  ```shell
  npm i apollo-server
  npm install --save-dev "graphql@0.13.1" // ì˜ì¡´ì„± ë¬¸ì œê°€ ë°œìƒí•œë‹¤ë©´
  ```

* index.js

  ```js
  const database = require('./database')
  const { ApolloServer, gql } = require('apollo-server')
  
  // schema ì •ì˜
  const typeDefs = gql`
    type Query {
      teams: [Team]
    }
    type Team {
      id: Int
      manager: String
      office: String
      extension_number: String
      mascot: String
      cleaning_duty: String
      project: String
    }
  `
  
  // resolvers ì •ì˜
  const resolvers = {
      Query: {
          teams: () => database.teams
      }
  }
  
  const server = new ApolloServer({ typeDefs, resolvers }) 
  server.listen().then(({ url }) => {
      console.log(`ğŸš€  Server ready at ${url}`)
  })
  ```



### ì½”ë“œ ì„¤ëª…

* ApolloServer
  * typeDefì™€ resolverë¥¼ ì¸ìë¡œ ë°›ì•„ ìƒì„±ìë¡œ ì„œë²„ ìƒì„±
  * listen ëª…ë ¹ì–´ë¡œ ì‹¤í–‰
* typeDef
  * GraphQL ëª…ì„¸ì—ì„œ ì‚¬ìš©ë  ë°ì´í„°, ìš”ì²­ì˜ íƒ€ì… ì§€ì •
  * gql (template literal tag) ë¡œ ìƒì„±ë¨
    * type Team {..} : íŒ€ì€ ì–´ë–¤ í•­ëª©ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆëŠ”ì§€
    * type Query {..} : ìš”ì²­í•  ì¿¼ë¦¬ì—ë„ ì–´ë– í•œ í˜•ì‹ìœ¼ë¡œ ìš”ì²­ì´ ë“¤ì–´ê°€ëŠ”ì§€ 

* resolver
  * ì„œë¹„ìŠ¤ì˜ **ì•¡ì…˜** ë“¤ì„ í•¨ìˆ˜ë¡œ ì§€ì •
  * ìš”ì²­ì— ë”°ë¼ ë°ì´í„°ë¥¼ ë°˜í™˜, ì…ë ¥, ìˆ˜ì •, ì‚­ì œ
* GraphQL Playground
  * ì‘ì„±í•œ GraphQL type, resolver ëª…ì„¸ í™•ì¸ ê°€ëŠ¥
  * ë°ì´í„° ìš”ì²­ ë° ì „ì†¡ í…ŒìŠ¤íŠ¸



## d. Mutation êµ¬í˜„í•˜ê¸°

* resolvers ì •ì˜
  * ì‹¤ì œë¡œ êµ¬í˜„í•  ë•Œ resolvers ì— Mutation ì—ëŠ” mySQL, Oracle ë“±ì˜ ëª…ë ¹ì–´ê°€ ë“¤ì–´ê°„ë‹¤.

```javascript
const resolvers = {
    Mutation: {
      insertEquipment: (parent, args, context, info) => {
          ..
      }
    }
}
```

* schema ì •ì˜

```javascript
type Mutation {
  	...
        insertEquipment(			// ì—¬ê¸° ì •ì˜ëœ id, used_by ... ë“±ì€ resolversì˜ argsë¡œ ì „ë‹¬ëœë‹¤.
            id: String,
            used_by: String
            count: Int,
            new_or_used: String        
        ): Equipment
    ...
    }
```





----

### ì¶œì²˜

* https://www.yalco.kr/@graphql-apollo/2-3/









